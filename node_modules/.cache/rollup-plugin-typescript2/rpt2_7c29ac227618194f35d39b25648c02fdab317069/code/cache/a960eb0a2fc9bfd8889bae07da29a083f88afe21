{"code":"import { isFunction } from '@vue/shared';\r\nimport { effect, track, trigger } from './effect';\r\nclass ComputedRefImpl {\r\n    getter;\r\n    setter;\r\n    _dirty = true; // 默认取值时不要用缓存\r\n    _value;\r\n    effect;\r\n    constructor(getter, setter) {\r\n        this.getter = getter;\r\n        this.setter = setter;\r\n        // 返还了effect的执行权限\r\n        this.effect = effect(getter, {\r\n            lazy: true,\r\n            scheduler: () => {\r\n                // 传入了scheduler后 下次数据更新 原则上应该让effect重新执行 下次更新会调用scheduler\r\n                if (!this._dirty) {\r\n                    // 依赖属性变化时\r\n                    this._dirty = true; // 标记为脏 触发视图更新\r\n                    trigger(this, 1 /* TriggerOrTypes.SET */, 'value');\r\n                }\r\n            },\r\n        });\r\n    }\r\n    // 如果用户不去计算属性中取值 就不会执行计算属性的effect\r\n    get value() {\r\n        // 计算属性也要收集依赖\r\n        if (this._dirty) {\r\n            this._value = this.effect(); // 会将用户的返回值返回\r\n            this._dirty = false;\r\n        }\r\n        track(this, 0 /* TrackOpTypes.GET */, 'value'); // 进行属性依赖收集\r\n        return this._value;\r\n    }\r\n    set value(newValue) {\r\n        // 当用户给计算属性设置值的时候会触发set方法 此时调用计算属性的setter\r\n        this.setter(newValue);\r\n    }\r\n}\r\nexport function computed(getterOrOptoins) {\r\n    let getter;\r\n    let setter;\r\n    if (isFunction(getterOrOptoins)) {\r\n        // computed两种写法\r\n        getter = getterOrOptoins;\r\n        setter = () => {\r\n            console.warn('computed value must be readonly');\r\n        };\r\n    }\r\n    else {\r\n        getter = getterOrOptoins.get;\r\n        setter = getterOrOptoins.set;\r\n    }\r\n    return new ComputedRefImpl(getter, setter);\r\n}\r\n//# sourceMappingURL=computed.js.map","references":["/Users/pangjianfeng/code/pf-vue3-source/vue3-render/packages/shared/src/index.ts","/Users/pangjianfeng/code/pf-vue3-source/vue3-render/packages/reactivity/src/effect.ts","/Users/pangjianfeng/code/pf-vue3-source/vue3-render/packages/reactivity/src/operators.ts"],"map":"{\"version\":3,\"file\":\"computed.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/computed.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,aAAa,CAAC;AACzC,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,UAAU,CAAC;AAGlD,MAAM,eAAe;IAIA;IAAe;IAH3B,MAAM,GAAG,IAAI,CAAC,CAAC,aAAa;IAC5B,MAAM,CAAC;IACP,MAAM,CAAC;IACd,YAAmB,MAAM,EAAS,MAAM;QAArB,WAAM,GAAN,MAAM,CAAA;QAAS,WAAM,GAAN,MAAM,CAAA;QACtC,iBAAiB;QACjB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE;YAC3B,IAAI,EAAE,IAAI;YACV,SAAS,EAAE,GAAG,EAAE;gBACd,yDAAyD;gBACzD,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;oBAChB,UAAU;oBACV,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC,cAAc;oBAClC,OAAO,CAAC,IAAI,8BAAsB,OAAO,CAAC,CAAC;iBAC5C;YACH,CAAC;SACF,CAAC,CAAC;IACL,CAAC;IACD,iCAAiC;IACjC,IAAI,KAAK;QACP,aAAa;QACb,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,aAAa;YAC1C,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACrB;QACD,KAAK,CAAC,IAAI,4BAAoB,OAAO,CAAC,CAAC,CAAC,WAAW;QACnD,OAAO,IAAI,CAAC,MAAM,CAAC;IACrB,CAAC;IACD,IAAI,KAAK,CAAC,QAAQ;QAChB,yCAAyC;QACzC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IACxB,CAAC;CACF;AAED,MAAM,UAAU,QAAQ,CAAC,eAAe;IACtC,IAAI,MAAM,CAAC;IACX,IAAI,MAAM,CAAC;IACX,IAAI,UAAU,CAAC,eAAe,CAAC,EAAE;QAC/B,eAAe;QACf,MAAM,GAAG,eAAe,CAAC;QACzB,MAAM,GAAG,GAAG,EAAE;YACZ,OAAO,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QAClD,CAAC,CAAC;KACH;SAAM;QACL,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC;QAC7B,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC;KAC9B;IACD,OAAO,IAAI,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC7C,CAAC\"}"}
