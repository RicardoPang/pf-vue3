{"code":"// 组件中所有的方法\r\nimport { isFunction, isObject } from '@vue/shared/src';\r\nimport { PublicInstanceProxyHandlers } from './componentPublicInstance';\r\nexport function createComponentInstance(vnode) {\r\n    // webcomponent 组件需要有“属性” “插槽”\r\n    const instance = {\r\n        // 组件的实例\r\n        vnode,\r\n        type: vnode.type,\r\n        props: {},\r\n        attrs: {},\r\n        slots: {},\r\n        ctx: {},\r\n        data: {},\r\n        setupState: {},\r\n        render: null,\r\n        subTree: null,\r\n        isMounted: false, // 表示这个组件是否挂载过\r\n    };\r\n    instance.ctx = { _: instance }; // instance.ctx._\r\n    return instance;\r\n}\r\nexport function setupComponent(instance) {\r\n    const { props, children } = instance.vnode; // {type,props,children}\r\n    // 根据props 解析出 props 和 attrs，将其放到instance上\r\n    instance.props = props; // initProps()\r\n    instance.children = children; // 插槽的解析 initSlot()\r\n    // 需要先看下 当前组件是不是有状态的组件， 函数组件\r\n    let isStateful = instance.vnode.shapeFlag & 4 /* ShapeFlags.STATEFUL_COMPONENT */;\r\n    if (isStateful) {\r\n        // 表示现在是一个带状态的组件\r\n        // 调用 当前实例的setup方法，用setup的返回值 填充 setupState和对应的render方法\r\n        setupStatefulComponent(instance);\r\n    }\r\n}\r\nfunction setupStatefulComponent(instance) {\r\n    // 1.代理 传递给render函数的参数\r\n    instance.proxy = new Proxy(instance.ctx, PublicInstanceProxyHandlers);\r\n    // 2.获取组件的类型 拿到组件的setup方法\r\n    let Component = instance.type;\r\n    let { setup } = Component;\r\n    // ------ 没有setup------\r\n    if (setup) {\r\n        let setupContext = createSetupContext(instance);\r\n        const setupResult = setup(instance.props, setupContext); // instance 中props attrs slots emit expose 会被提取出来，因为在开发过程中会使用这些属性\r\n        handleSetupResult(instance, setupResult);\r\n    }\r\n    else {\r\n        finishComponentSetup(instance); // 完成组件的启动\r\n    }\r\n}\r\nfunction handleSetupResult(instance, setupResult) {\r\n    if (isFunction(setupResult)) {\r\n        instance.render = setupResult;\r\n    }\r\n    else if (isObject(setupResult)) {\r\n        instance.setupState = setupResult;\r\n    }\r\n    finishComponentSetup(instance);\r\n}\r\nfunction finishComponentSetup(instance) {\r\n    let Component = instance.type;\r\n    if (!instance.render) {\r\n        // 对template模板进行编译 产生render函数\r\n        // instance.render = render;// 需要将生成render函数放在实例上\r\n        if (!Component.render && Component.template) {\r\n            // 编译 将结果 赋予给Component.render\r\n        }\r\n        instance.render = Component.render;\r\n    }\r\n    // 对vue2.0API做了兼容处理\r\n    // applyOptions\r\n}\r\nfunction createSetupContext(instance) {\r\n    return {\r\n        attrs: instance.attrs,\r\n        slots: instance.slots,\r\n        emit: () => { },\r\n        expose: () => { },\r\n    };\r\n}\r\n// 他们的关系涉及到后面的使用\r\n// instance 表示的组件的状态 各种各样的状态，组件的相关信息\r\n// context 就4个参数 是为了开发时使用的\r\n// proxy 主要为了取值方便  =》 proxy.xxxx\r\n//# sourceMappingURL=component.js.map","references":["/Users/pangjianfeng/code/pf-vue3-source/vue3-render/packages/shared/src/index.ts","/Users/pangjianfeng/code/pf-vue3-source/vue3-render/packages/runtime-core/src/componentPublicInstance.ts"],"map":"{\"version\":3,\"file\":\"component.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/runtime-core/src/component.ts\"],\"names\":[],\"mappings\":\"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\"}"}
